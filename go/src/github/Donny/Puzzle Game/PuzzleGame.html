<!DOCTYPE html>
<html>
<head>
	<title>Puzzle Game</title>
</head>
<body>
	<canvas id="Puzzle" width="600" height="600"></canvas>


  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

	<script type="text/javascript">
	function ImgMovable(x,y,source){
		this.image = null;
		this.x = x;
		this.y = y;
    this.num = null;
		
	}

  var images = {};
	function loadImages(sources,callback) {
        var numberOfSources = 0;
        var loadedImages = 0;
        
        for(var src in sources){
        	numberOfSources++;
        }
        
        var y = 0;
        var x = 0;
        var count = 0;
        
        for(var src in sources) {
          images[src] = new ImgMovable(x,y);
          images[src].image = new Image();
          images[src].image.onload = function() {
          	if(numberOfSources <= ++loadedImages){
          		callback(images);
          	}
          };
          images[src].image.src = sources[src];
          
          y += 200;
          if((++count) == 3){
            x+=200;
            y = 0;
            count = 0;
          }

        }

      }

      var canvas = document.getElementById('Puzzle');
      var context = canvas.getContext('2d');
    	

      var sources = {
        darthVader: 'http://www.html5canvastutorials.com/demos/assets/darth-vader.jpg',
        yoda: 'http://www.html5canvastutorials.com/demos/assets/yoda.jpg',
        obi_wan: 'http://img3.wikia.nocookie.net/__cb20111208191614/starwars/tr/images/5/5a/Obi2.jpg',
        count_dooku: 'http://img3.wikia.nocookie.net/__cb20091216160323/swfanon/images/thumb/b/b3/CountDooku.jpg/250px-CountDooku.jpg',
        mace_windu: 'http://s2.quickmeme.com/img/36/36da73b03a3c8ba42912be0c03046ca891dd5156b1bce6789d3460fae46fe566.jpg'
      };



      loadImages(sources,function(){
        var count = 0;
        for(var img in images){

          context.drawImage(images[img].image,
                    images[img].x,images[img].y,
                              200,200);
        }
    
      });

    $("#Puzzle").click(function(){
        var img = null;
        var x = event.pageX - $("#Puzzle").position().left;
        var y = event.pageY - $("#Puzzle").position().top;
        for(var image in images){
          var isIn = isImageClicked(x,y,images[image]) 
          if(isIn){
              img = images[image];
          }
        }
        goToFreeSpace(img);


        redrawCanvas(images);
      });
   
    function redrawCanvas(images){
      var canvas = document.getElementById('Puzzle');
      var context = canvas.getContext('2d');
      context.clearRect(0,0,canvas.width,canvas.height);

      for(var img in images){
        context.drawImage(images[img].image, images[img].x,images[img].y,200,200);
      }
    }

    function isImageClicked(x,y,image){
      return (image.x < x) && (image.y < y) &&
             (x < (image.x + 200)) && (y < (image.y + 200));
    }

    function goToFreeSpace(image){
        var length = 200;
        
        var top = image.y == 0;
        var left = image.x == 0;
        var bottom = image.y == 400;
        var right = image.x == 400;

        for(var img in images){
            if(images[img].y == (image.y - length) && images[img].x == image.x){
              top = true;
            }

            if(images[img].x == (image.x + length) && images[img].y == image.y){
              right = true;
          
            }

            if(images[img].y == (image.y + length) && images[img].x == image.x){
              bottom = true;
            }

            if(images[img].x == (image.x - length) && images[img].y == image.y){
              left = true;
            
            }
        }

        if(!top){
          image.y -= 200;
        } else if(!right){
          image.x += 200;
        } else if(!bottom){
          image.y += 200;
        } else if(!left){
          image.x -= 200;
        }

        redrawCanvas(images);
    }

	</script>

</body>


</html>